# 开发日志 - 2026年第9周

> 时间范围：2026-02-24 至 2026-03-02

## 本周目标
- [x] 完成日志库核心功能开发
- [x] 实现访问日志写入 SQLite 数据库
- [x] 配置日志数据库分表机制
- [x] 搭建前端基础设施
- [x] 实现登录页和后台主布局

## 完成情况

### 日志库实现
- [x] 创建独立日志数据库 `db/hospital.log.db`
- [x] 实现三种日志类型：
  - **SQL 日志** - 通过 `SqlLoggingInterceptor` 拦截 Hibernate SQL
  - **审计日志** - 通过 `AuditLogger` 记录用户操作
  - **访问日志** - 通过 `DbLoggingFilter` 记录 HTTP 请求
- [x] 实现分表机制（支持 YEAR/MONTH/WEEK/DAY 模式）
- [x] 实现批量写入和定时刷新机制

### 前端基础设施搭建
- [x] 安装核心依赖：Element Plus、Vue Router 4、Pinia、Axios
- [x] 配置 Vite：修正 proxy 端口 5000→8080，添加 `@/` 路径别名
- [x] 配置 TypeScript：`baseUrl` + `paths` 支持 `@/` 导入
- [x] 封装 Axios：请求拦截器（JWT Token 注入）、响应拦截器（统一错误处理、401 自动跳转）
- [x] Token 管理：独立 `utils/token.ts` 模块，避免循环依赖
- [x] TypeScript 类型定义：`Result<T>`、`PageResult<T>`、所有实体接口、路由 meta 类型扩展
- [x] Pinia 用户 Store：login / fetchUserInfo / logout
- [x] Vue Router：HTML5 History 模式、导航守卫（Token/用户信息校验）
- [x] 主布局 `MainLayout.vue`：深色侧边栏（可折叠）+ 白色顶栏 + 灰色内容区
- [x] 登录页 `LoginView.vue`：Element Plus 表单验证、loading 防重复、回车提交
- [x] 仪表盘 `DashboardView.vue`：统计卡片占位
- [x] 6 个业务占位页面：患者、医生、科室、预约、病历、药品

### 后端安全修复
- [x] `SecurityConfig.java` 添加 `/api/v1/users/login` 到 permitAll 白名单
- [x] `JwtAuthenticationFilter.java` 添加 `/api/v1/users/login` 到 shouldNotFilter

### 清理默认模板
- [x] 删除 `HelloWorld.vue`、`vue.svg`、`style.css`
- [x] 简化 `App.vue` 为 `<router-view />`
- [x] `main.ts` 注册 Pinia、Router、Element Plus（中文）、全局图标

### 新增文件
**前端（18 个新文件）：**
- `src/types/api.ts` - API 响应类型
- `src/types/auth.ts` - 认证类型
- `src/types/entity.ts` - 所有实体接口
- `src/types/router.d.ts` - 路由 meta 类型扩展
- `src/utils/token.ts` - Token 管理
- `src/api/index.ts` - Axios 实例 + 拦截器
- `src/api/modules/auth.ts` - 认证 API
- `src/stores/user.ts` - Pinia 用户 Store
- `src/router/index.ts` - 路由配置 + 导航守卫
- `src/layouts/MainLayout.vue` - 后台主布局
- `src/views/login/LoginView.vue` - 登录页
- `src/views/dashboard/DashboardView.vue` - 仪表盘
- `src/views/patient/PatientView.vue` - 患者管理（占位）
- `src/views/doctor/DoctorView.vue` - 医生管理（占位）
- `src/views/department/DepartmentView.vue` - 科室管理（占位）
- `src/views/appointment/AppointmentView.vue` - 预约挂号（占位）
- `src/views/medical-record/MedicalRecordView.vue` - 病历管理（占位）
- `src/views/medicine/MedicineView.vue` - 药品管理（占位）

### 配置更新
- 新增配置项：`logging.db.database-path`、`logging.db.batch-size`、`logging.db.flush-interval`
- 新增 Hibernate 配置：`statement_inspector`
- `vite.config.ts`：proxy 端口修正、`@/` 别名
- `tsconfig.app.json`：`baseUrl` + `paths`
- `index.html`：lang→zh-CN、标题更新

## 数据库表结构
```
db/hospital.log.db
├── access_log       # 访问日志主表
├── access_log_20260225  # 按天分表（测试用）
├── audit_log        # 审计日志主表
└── sql_log          # SQL日志主表
```

## 验证结果

### 日志写入验证
```
=== Access logs ===
id | method | url                      | status | duration
1  | GET    | /swagger-ui/index.html  | 200    | 116
2  | GET    | /swagger-ui/index.html  | 200    | 28
...
```

### 前端构建验证
- TypeScript 类型检查：通过（零错误）
- 生产构建：成功（5.38s）

## 已知问题（TODO）

### 已修复
- [x] 分表写入 BUG
- [x] 启用 SQL 日志拦截功能
- [x] 启用审计日志拦截功能
- [x] 添加数据清理定时任务
- [x] 后端登录接口安全白名单缺失

### 待完成
- [ ] 实现日志查询 API（分页查询访问日志）
- [ ] 添加日志导出功能
- [ ] 完善日志分析页面
- [ ] 实现各业务页面的 CRUD 功能
- [ ] 仪表盘统计数据对接后端 API

## 下周计划
- [ ] 实现患者管理页面完整 CRUD
- [ ] 实现医生管理页面完整 CRUD
- [ ] 实现科室管理页面完整 CRUD
- [ ] 仪表盘对接统计 API
- [ ] 日志查询 API

## 备注
- 前端基础设施已完成，可以开始逐个业务模块的页面开发
- 当前版本：v26.2.3